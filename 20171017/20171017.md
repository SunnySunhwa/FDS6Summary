# Ajax
- Ajax는 자바스크립트를 이용해서 비동기적으로 서버와 브라우저가 데이터를 교환할 수 있는 통신 방식을 의미한다.
페이지 전체를 로드하여 렌더링할 필요가 없고 갱신이 필요한 부분만 로드하여 갱신하면 되므로 빠른 퍼포먼스와 부드러운 화면 표시효과를 기대할 수 있다.

## JSON
- 서버는 HTML, Text, JSON 등을 반환하는데 Ajax을 위한 데이터 형식은 JSON을 사용하는 것이 일반적이다.
- JSON은 순수한 텍스트로 구성된 데이터이다.
- 키는 반드시 큰따옴표(작은따옴표 사용불가)로 둘러싸야 한다.
- `JSON.stringify` : 객체 -> JSON형식 문자열로 변환
- `JSON.parse()` : JSON형식 문자열 -> 객체로 변환

## XMLHttpRequest
브라우저는 XMLHttpRequest 객체를 이용하여 Ajax 요청을 생성하고 전송한다. 
서버가 브라우저의 요청에 대해 응답을 반환하면 같은 XMLHttpRequest 객체가 그 결과를 처리한다.

### Ajax request
1. 객체를 생성한다.
2. 비동기 방식으로 Request를 오픈한다 (open)
3. Request를 전송한다 (send)

##### XMLHttpRequest.open
서버로의 요청을 준비한다.
`XMLHttpRequest.open(method, url, async)`
- method : HTTP method (“GET”, “POST”, “PUT”, “DELETE” 등)
- url : 요청을 보낼 URL
- asycn : 비동기 조작 여부 (defalt : true)

##### XMLHttpRequest.send
준비된 요청을 서버에 전달한다. 
request body에 담아 전송할 인수를 전달할 수 있다.

- GET : URL의 일부분인 쿼리문자열로 데이터를 서버로 전송
- POST : 데이터(페이로드)를 Request Body에 담아 전송

요청 메소드가 GET인 경우, send메소드의 인수는 무시되고 request body는 null로 설정된다.

##### XMLHttpRequest.setRequestHeader
HTTP Request Header의 값을 설정한다.
`XMLHttpRequest.setRequestHeader(header, value)`
두가지의 header가 자주 사용된다
- Content-type : request body에 담아 전송할 데이터의 MIME-type의 정보를 표현한다. 자주 사용되는 MIME-type은 아래와 같다.
  - text 타입 : text/plain, text/html, text/css, text/javascript
  - Applcation 타입 : application/json, application/x-www-form-urlencode
  - File을 업로드하기 위한 타입 : multipart/formed-data
- Accept : HTTP 클라이언트가 서버에 요청할 때 서버가 센드백할 데이터의 MIME-type을 Accept로 지정할 수 있다.


### Ajax response
1. `XMLHttpRequest.readyState` 프로퍼티가 변경될 때마다 이벤트 핸드러를 호출
2. readyStates는 XMLHttpRequest의 상태(state)를 반환
3. readyState: 4 => DONE(서버 응답 완료)
4. response 상태 코드를 반환 
(상태코드 참고 : https://developer.mozilla.org/ko/docs/Web/HTTP/Status)

`XMLHttpRequest.onreadystatechange`는 Response가 클라이언트에 도달하여 발생된 이벤트를 감지하고 콜백함수를 실행하여 준다. 이때 이벤트는 Request에 어떠한 변화가 발생한 경우 즉 `XMLHttpRequest.readyState` 프로퍼티가 변경된 경우 발생한다.

`XMLHttpRequest.readyState` : response가 클라이언트에 도달했는지를 추적할 수 있는 프로퍼티
| value | State            | Description                                           |
|:-----:|------------------|-------------------------------------------------------|
| 0     | UNSENT           | XMLHttpRequest.open() 메소드 호출 이전                |
| 1     | OPENED           | XMLHttpRequest.open() 메소드 호출 완료                |
| 2     | HEADERS_RECEIVED | XMLHttpRequest.open() 메소드 호출 완료                |
| 3     | LOADING          | 서버 응답 중(XMLHttpRequest.responseText 미완성 상태) |
| 4     | DONE             | 서버 응답 완료                                        |
XMLHttpRequest의.readyState가 4인 경우, 서버 응답이 완료된 상태이므로 이후 `XMLHttpRequest.status`가 200(정상 응답)임을 확인하고 정상인 경우, `XMLHttpRequest.responseText`를 취득한다. `XMLHttpRequest.responseText`에는 **서버가 전송한 데이터**가 담겨 있다.

##### Load JSON
서버로부터 브라우저로 전송된 JSON 데이터는 문자열이다. 이 문자열을 객체화하여야 하는데 이를 **역직렬화(Deserializing)**이라 한다. 역직렬화를 위해서 내장 객체 JSON의 static 메소드인 JSON.parse()를 사용한다.


##### Load JSONP
요청에 의해 웹페이지가 전달된 서버와 동일한 도메인의 서버로 부터 전달된 데이터는 문제없이 처리할 수 있다. 하지만 보안상의 이유로 다른 도메인(http와 https, 포트가 다르면 다른 도메인으로 간주한다)으로의 요청(크로스 도메인 요청)은 제한된다. 이것을 **동일출처원칙(Same-origin policy)**이라고 한다

- 동일출처 원칙을 우회하는 세가지 방법
    1. 웹서버의 프록시
    2. JSONP (제일 많이 사용됨)
    3. Cross-Origin Resource Sharing 